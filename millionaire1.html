<!doctype html>
<html lang="mi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Who Wants to Be a Millionaire #1 ‚Äî Te Reo (Year 10, Term 3)</title>
  <style>
    :root{
      --bg:#fdfcf8; --card:#ffffff; --accent:#ff9e2c; --muted:#444; --good:#28a745; --bad:#e63946;
      font-family: 'Poppins', 'Segoe UI', system-ui, -apple-system, sans-serif;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#fff7e6 0%, #ffefd5 100%);color:#222}
    .wrap{height:90vh;width:95%;max-width:1100px;margin:2vh auto;display:grid;grid-template-columns:1fr 300px;gap:18px;align-items:start}
    @media (max-width:900px){.wrap{grid-template-columns:1fr;padding-bottom:10vh}}

    header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;background:#fff9f2;padding:12px 16px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    h1{font-size:1.8rem;margin:0;color:#ff6f00}
    .meta{font-size:1rem;color:#666}

    .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.05)}

    .game{min-height:60vh}
    .question{font-size:1.5rem;margin-bottom:14px;color:#222}
    .question small{display:block;color:var(--muted);font-size:1rem;margin-top:6px}

    .answers{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:600px){.answers{grid-template-columns:1fr}}

    .btn{background:#fff5e6;border:2px solid #ffcd94;padding:14px;border-radius:10px;cursor:pointer;text-align:left;font-size:1.15rem}
    .btn:hover{background:#ffe7c2}
    .btn.correct{border-color:var(--good);background:#e6f8ec}
    .btn.wrong{border-color:var(--bad);background:#fdeaea}
    
    #resetBtn { background: #ffedd9; border: 2px solid #ffd8a8; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; }
    #resetBtn:hover { background: #ffe7c2; }


    .sidebar{position:sticky;top:16px;height:fit-content}
    .ladder{list-style:none;padding:12px;margin:0;}
    .ladder li{padding:10px 12px;border-radius:8px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;background:#fff7f0;font-size:1rem}
    .ladder li.active{background:#ffe1b3;color:#000;font-weight:bold}

    .lifelines{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .life{padding:8px 12px;border-radius:8px;background:#ffedd9;cursor:pointer;border:2px solid #ffd8a8;font-size:0.95rem}
    .life.used{opacity:0.4;text-decoration:line-through;cursor:default}
    .lifelines.hidden { display: none; }

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:var(--muted)}
    .tiny{font-size:0.95rem}

    #confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none}

    .teacher-joke{font-style:italic;color:#555;margin-top:6px;font-size:1rem}
    .big-win{font-size:1.3rem;color:var(--good);font-weight:700}

    /* make buttons and text more readable on small devices */
    @media (max-width:420px){
      h1{font-size:1.3rem}
      .question{font-size:1.2rem}
      .btn{font-size:1rem;padding:12px}
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <header>
      <div>
        <h1>Millionaire #1 Kura Edition ‚ú®üåº</h1>
        <div class="meta">Kia pai te mutunga o te wƒÅhanga ‚Äî bright, fun, and springtime vibes!</div>
      </div>
      <button id="resetBtn">Reset Game</button>
    </header>

    <main class="card game">
      <div id="status" class="tiny">Question <span id="qIndex">1</span> / <span id="qTotal">10</span> ‚Ä¢ Winnings: <strong id="points">$0</strong></div>

      <div id="questionBox" style="margin-top:12px">
        <div class="question" id="questionText">Loading...</div>
        <div class="answers" id="answers"></div>
      </div>

      <div class="footer">
        <div>
          <div class="lifelines" id="lifelines">
            <div class="life" data-life="50">50:50</div>
            <div class="life" data-life="ask">Ask the Class</div>
            <div class="life" data-life="skip">Skip</div>
          </div>
          <div class="teacher-joke" id="joke">Spring joke: Why did the student bring a ladder to kura? To reach high marks! üå∏</div>
        </div>
        <div class="tiny">
          <button id="nextBtn" class="btn" style="padding:8px 14px; display: none;">Next</button>
        </div>
      </div>
    </main>

    <aside class="card sidebar">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div>
          <div class="tiny">Whakamahi / Session</div>
          <div id="lastPlayed">Last played: never</div>
        </div>
        <div style="text-align:right">
          <div class="tiny">Kaute</div>
          <div id="userPoints">Saved: $0</div>
        </div>
      </div>

      <div style="margin-bottom:12px">
        <strong>Prize ladder</strong>
        <ul class="ladder" id="ladder"></ul>
      </div>

      <div>
        <strong>Hints</strong>
        <p class="tiny">He kƒìmu ngahau m≈ç ngƒÅ tau 10. Enjoy the spring break mood ‚Äî pƒÅtai ngƒÅwari me ngƒÅ katakata! üåº</p>
      </div>
    </aside>
  </div>

  <script>
    const QUESTIONS = [
      {q: 'He aha te kupu MƒÅori m≈ç "school"?', choices:['Whareako','Kura','R≈´ma','HƒÅkinakina'], answer:1, hint:'Think of signs ‚Äî kura!'},
      {q: 'Which of these is a toi MƒÅori artform?', choices:['Kapa haka','Rugby','Poi','Football'], answer:0},
      {q: 'What does "Haere rƒÅ" mean?', choices:['Hello','Goodbye','Thank you','Please'], answer:1},
      {q: 'Ko wai tƒìrƒÅ? means?', choices:['Where','When','Who','Why'], answer:2},
      {q: 'Translate: "NgƒÅ mihi"', choices:['Congrats','Greetings/thanks','Good night','See you later'], answer:1},
      {q: 'MƒÅori word for family?', choices:['WhƒÅnau','Waka','Mahi','Kai'], answer:0},
      {q: 'Translate: "Kia mau te wehi"', choices:['Be brave','Be awesome','Be quiet','Be careful'], answer:1},
      {q: 'Which word means sea?', choices:['Moana','Awa','KƒÅkƒÅ','Maunga'], answer:0},
      {q: 'Meaning of "tere"?', choices:['Fast/quick','Happy','Green','Small'], answer:0},
      {q: '"E te Atua..." begins?', choices:['Greeting','Prayer','Song','Dance'], answer:1}
    ];

    const PRIZES = [100, 200, 300, 500, 1000, 2000, 8000, 16000, 250000, 1000000];

    let idx = 0;
    let winnings = 0;
    let usedLifelines = { '50': false, ask: false, skip: false };

    const qTotal = QUESTIONS.length;
    document.getElementById('qTotal').innerText = qTotal;

    const ladderEl = document.getElementById('ladder');
    PRIZES.slice().reverse().forEach((p, i) => {
      const li = document.createElement('li');
      li.id = 'lad-' + (PRIZES.length - 1 - i);
      li.innerHTML = `<span>${PRIZES.length - 1 - i + 1}.</span> <strong>$${p.toLocaleString()}</strong>`;
      ladderEl.appendChild(li);
    });

    function saveSession() {
      const now = new Date().toLocaleString();
      localStorage.setItem('wwtbam_winnings', winnings);
      localStorage.setItem('wwtbam_last', now);
      document.getElementById('userPoints').innerText = `$${winnings.toLocaleString()}`;
      document.getElementById('lastPlayed').innerText = now;
    }

    function loadSession() {
      const p = localStorage.getItem('wwtbam_winnings') || 0;
      const l = localStorage.getItem('wwtbam_last') || 'never';
      winnings = Number(p);
      document.getElementById('points').innerText = `$${winnings.toLocaleString()}`;
      document.getElementById('userPoints').innerText = `$${winnings.toLocaleString()}`;
      document.getElementById('lastPlayed').innerText = l;
    }

    function renderQuestion() {
      if (idx >= QUESTIONS.length) return;
      document.getElementById('nextBtn').style.display = 'none';
      const Q = QUESTIONS[idx];
      document.getElementById('qIndex').innerText = idx + 1;
      document.getElementById('questionText').innerHTML = Q.q + (Q.hint ? (`<small>${Q.hint}</small>`) : '');

      const answers = document.getElementById('answers');
      answers.innerHTML = '';
      Q.choices.forEach((c, i) => {
        const b = document.createElement('button');
        b.className = 'btn';
        b.innerText = c;
        b.dataset.index = i;
        b.addEventListener('click', onAnswer);
        answers.appendChild(b);
      });

      document.querySelectorAll('.ladder li').forEach(li => li.classList.remove('active'));
      const curL = document.getElementById('lad-' + idx);
      if (curL) curL.classList.add('active');
    }

    function onAnswer(e) {
      const chosen = Number(e.currentTarget.dataset.index);
      const Q = QUESTIONS[idx];
      const buttons = Array.from(document.querySelectorAll('.answers .btn'));
      buttons.forEach(btn => btn.disabled = true);

      if (chosen === Q.answer) {
        e.currentTarget.classList.add('correct');
        winnings = PRIZES[idx];
        document.getElementById('points').innerText = `$${winnings.toLocaleString()}`;
        document.getElementById('joke').innerText = pickTeacherPraise();
        document.getElementById('nextBtn').style.display = 'block';
        saveSession();
        setTimeout(celebrate, 400);
      } else {
        e.currentTarget.classList.add('wrong');
        const correctBtn = buttons.find(b => Number(b.dataset.index) === Q.answer);
        if (correctBtn) correctBtn.classList.add('correct');
        document.getElementById('joke').innerText = pickTeacherComfort();
        winnings = 0; // Reset winnings
        handleWrongAnswer();
      }
    }

    function handleWrongAnswer() {
      gameOver(false);
      triggerBlackConfetti();
      setTimeout(resetGame, 5000);
    }

    function nextQuestion() {
      idx++;
      if (idx >= QUESTIONS.length) {
        gameOver(true);
        return;
      }
      renderQuestion();
    }
    
    function resetGame() {
      confettiPieces = []; // Immediately stop any confetti
      idx = 0;
      winnings = 0;
      usedLifelines = { '50': false, ask: false, skip: false };
      document.getElementById('points').innerText = `$${winnings}`;
      document.querySelectorAll('.life').forEach(l => l.classList.remove('used'));
      document.getElementById('lifelines').classList.remove('hidden');
      document.getElementById('joke').innerText = 'Spring joke: Why did the student bring a ladder to kura? To reach high marks! üå∏';
      renderQuestion();
    }


    document.getElementById('nextBtn').addEventListener('click', nextQuestion);
    document.getElementById('resetBtn').addEventListener('click', resetGame);

    document.getElementById('lifelines').addEventListener('click', (ev) => {
      const t = ev.target.closest('.life');
      if (!t || t.classList.contains('used')) return;
      useLifeline(t.dataset.life, t);
    });

    function useLifeline(name, el) {
      usedLifelines[name] = true;
      el.classList.add('used');
      const Q = QUESTIONS[idx];

      if (name === '50') {
        const wrongs = [];
        Q.choices.forEach((c, i) => { if (i !== Q.answer) wrongs.push(i); });
        shuffleArray(wrongs);
        const toRemove = wrongs.slice(0, 2);
        document.querySelectorAll('.answers .btn').forEach(b => {
          if (toRemove.includes(Number(b.dataset.index))) {
            b.disabled = true;
            b.style.opacity = 0.35;
          }
        });
      } else if (name === 'ask') {
        const poll = [10, 10, 10, 10];
        poll[Q.answer] += 60;
        for (let i = 0; i < poll.length; i++) {
          poll[i] = Math.max(0, Math.round(poll[i] + (Math.random() * 10 - 5)));
        }
        showToast('Ask the Class: ' + poll.map((p, i) => `${String.fromCharCode(65 + i)}:${p}%`).join(' '));
      } else if (name === 'skip') {
        showToast('Skipped ‚Äî kia pai! (You keep your points).');
        nextQuestion();
      }
      
      // FIX: Ensure question text is not cleared by toast messages from lifelines.
      document.getElementById('questionText').innerHTML = Q.q + (Q.hint ? ("<small>" + Q.hint + "</small>") : '');
    }

    function gameOver(won) {
      document.getElementById('lifelines').classList.add('hidden');
      if (won) {
        document.getElementById('questionText').innerHTML = `<div class="big-win">Kua toa! You finished ‚Äî NgƒÅ mihi nui! üåºüéâ</div>`;
        document.getElementById('answers').innerHTML = `<div class="tiny">Final Winnings: <strong>$${winnings.toLocaleString()}</strong></div>`;
        triggerConfetti();
      } else {
        document.getElementById('questionText').innerHTML = `<div class="bad">KƒÅore i te tika ‚Äî but spring means new chances! üå±</div>`;
        document.getElementById('answers').innerHTML = `<div class="tiny">Winnings reset to <strong>$0</strong></div>`;
      }
      saveSession();
    }

    function showToast(msg) { document.getElementById('joke').innerText = msg; }

    function pickTeacherPraise() {
      const list = ['Ka rawe! üå∏', 'Tino pai! üåº', 'He toa koe! üåû'];
      return list[Math.floor(Math.random() * list.length)];
    }

    function pickTeacherComfort() {
      const list = ['Kia kaha ‚Äî like spring flowers, try again! üå∑', 'Almost! Keep blooming! üåº', 'New growth next round üå±'];
      return list[Math.floor(Math.random() * list.length)];
    }

    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    function resizeCanvas() { confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function triggerConfetti() {
      confettiPieces = [];
      for (let i = 0; i < 120; i++) {
        confettiPieces.push({ x: Math.random() * confettiCanvas.width, y: Math.random() * -confettiCanvas.height, r: Math.random() * 6 + 4, d: Math.random() * 2 + 1, tilt: Math.random() * 10, color: `hsl(${Math.random() * 360},70%,60%)` });
      }
      requestAnimationFrame(drawConfetti);
      setTimeout(() => { confettiPieces = []; }, 4000);
    }

    function triggerBlackConfetti() {
      confettiPieces = [];
      for (let i = 0; i < 150; i++) {
        confettiPieces.push({ 
          x: Math.random() * confettiCanvas.width, 
          y: Math.random() * -confettiCanvas.height, 
          r: Math.random() * 5 + 3,
          d: Math.random() * 2 + 1, 
          tilt: Math.random() * 10, 
          color: `hsl(0, 0%, ${Math.random() * 40}%)`
        });
      }
      requestAnimationFrame(drawConfetti);
      setTimeout(() => { confettiPieces = []; }, 5000); // Clear after 5s
    }

    function drawConfetti() {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confettiPieces.forEach(p => {
        p.y += p.d; p.tilt += 0.1;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.tilt * 0.02);
        ctx.fillStyle = p.color; ctx.fillRect(-p.r / 2, -p.r / 2, p.r, p.r * 0.6);
        ctx.restore();
      });
      if (confettiPieces.length) requestAnimationFrame(drawConfetti);
    }

    function shuffleArray(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
    }

    function celebrate() {
      triggerConfetti();
    }

    loadSession();
    renderQuestion();

    window.addEventListener('keydown', (e) => {
      const key = e.key.toLowerCase();
      if (['a', 'b', 'c', 'd'].includes(key)) {
        const idxMap = { 'a': 0, 'b': 1, 'c': 2, 'd': 3 }[key];
        const btn = document.querySelector(`.answers .btn[data-index='${idxMap}']`);
        if (btn && !btn.disabled) btn.click();
      } else if (key === 'n') document.getElementById('nextBtn').click();
    });
  </script>
</body>
</html>
