<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Te Reo Pronouns Grid Game</title>
<style>
body{font-family:Arial,sans-serif;background:#fbf8f6;color:#222;padding:14px;}
h2{margin:6px 0 12px;}
.controls{display:flex;gap:10px;margin-bottom:12px;flex-wrap:wrap;}
button{padding:10px 14px;border-radius:6px;border:1px solid #bbb;background:#fff;cursor:pointer;font-size:1em;}
#gameWrap{display:flex;gap:20px;align-items:flex-start;}
#gridContainer{position:relative;}
table{border-collapse:collapse;width:488px;height:288px;}
th,td{width:120px;height:70px;text-align:center;vertical-align:middle;border:1px solid #999;position:relative;padding:5px;box-sizing:border-box;}
td.invalid{background:none;cursor:default;}
td.selected{outline:3px solid black; z-index:2;}
th.row-header{color:black;}
#cardPool{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:380px;}
.card{width:110px;height:50px;background:pink;border:1px solid #888;border-radius:6px;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer;user-select:none;font-size:0.9em;color:black;font-weight:bold;position:relative;box-sizing:border-box;}
.card.correct{font-weight:bold;}
.card .translation{font-weight:normal;font-size:0.75em;margin-top:2px;color:#222;}
.fixed-card{background:#666;color:#fff;cursor:default;font-weight:bold;}
#completionMessage {margin-top: 20px; font-size: 2em; text-align: center; display: none;}
.rainbow-letter {font-weight: bold;}
</style>
</head>
<body>

<h2>Te Reo Pronouns Grid</h2>

<div class="controls">
<button id="newGameBtn">New Game</button>
<button id="showSolutionBtn">Show Solution</button>
<button id="showTranslationBtn">Show Translation</button>
</div>

<div id="gameWrap">
  <div id="gridContainer">
    <table id="gridTable">
      <thead>
        <tr>
          <th></th>
          <th>1</th>
          <th>2</th>
          <th>3+</th>
        </tr>
      </thead>
      <tbody>
        <tr data-row="me">
          <th class="row-header" style="background:yellow;">me</th>
          <td class="grid-cell" data-row="me" data-col="1"></td>
          <td class="grid-cell" data-row="me" data-col="2"></td>
          <td class="grid-cell" data-row="me" data-col="3+"></td>
        </tr>
        <tr data-row="us">
          <th class="row-header" style="background:lightgreen;">us</th>
          <td class="grid-cell invalid" data-row="us" data-col="1"></td>
          <td class="grid-cell" data-row="us" data-col="2"></td>
          <td class="grid-cell" data-row="us" data-col="3+"></td>
        </tr>
        <tr data-row="you">
          <th class="row-header" style="background:#7fc3ff;">you</th>
          <td class="grid-cell" data-row="you" data-col="1"></td>
          <td class="grid-cell" data-row="you" data-col="2"></td>
          <td class="grid-cell" data-row="you" data-col="3+"></td>
        </tr>
        <tr data-row="them">
          <th class="row-header" style="background:#d0a0ff;">them</th>
          <td class="grid-cell" data-row="them" data-col="1"></td>
          <td class="grid-cell" data-row="them" data-col="2"></td>
          <td class="grid-cell" data-row="them" data-col="3+"></td>
        </tr>
      </tbody>
    </table>
    <div id="completionMessage"></div>
  </div>

  <div id="cardPool"></div>
</div>

<script>
const pronouns=[
  {text:'au/ahau',row:'me',col:'1',translation:'I'},
  {text:'māua',row:'me',col:'2',translation:'we (2 excl.)'},
  {text:'mātou',row:'me',col:'3+',translation:'we (3+ excl.)'},
  {text:'tāua',row:'us',col:'2',translation:'we (2 incl.)'},
  {text:'tātou',row:'us',col:'3+',translation:'we (3+ incl.)'},
  {text:'koe',row:'you',col:'1',translation:'you (1)'},
  {text:'kōrua',row:'you',col:'2',translation:'you (2)'},
  {text:'koutou',row:'you',col:'3+',translation:'you (3+)'},
  {text:'ia',row:'them',col:'1',translation:'he/she/it'},
  {text:'rāua',row:'them',col:'2',translation:'they (2)'},
  {text:'rātou',row:'them',col:'3+',translation:'they (3+)'}
];

const rowColors={me:'yellow',us:'lightgreen',you:'#7fc3ff',them:'#d0a0ff'};
const rainbowColors = ['red', 'orange', '#0000FF', 'green', 'blue', 'indigo', 'violet'];
let currentPool = [];
let selectedCell = null;

function shuffle(array) {return array.slice().sort(() => Math.random() - 0.5);}

function newGame() {
  document.querySelectorAll('.grid-cell').forEach(c => {
    c.innerHTML = ''; c.dataset.placed = ''; c.classList.remove('selected'); 
    c.style.background = '';
  });
  currentPool = shuffle(pronouns);
  renderPool();
  const us1Cell = document.querySelector('td[data-row="us"][data-col="1"]');
  const fixedCard = document.createElement('div');
  fixedCard.className = 'card fixed-card';
  fixedCard.textContent = '—';
  us1Cell.appendChild(fixedCard);
  selectedCell = null;
  nextEmptyCell();
  document.getElementById('completionMessage').style.display = 'none';
  document.getElementById('completionMessage').innerHTML = '';
}

function renderPool() {
  const pool = document.getElementById('cardPool');
  pool.innerHTML = '';
  currentPool.forEach(p => {
    const card = createCard(p);
    pool.appendChild(card);
  });
}

function createCard(p) {
  const card = document.createElement('div');
  card.className = 'card';
  const te = document.createElement('div'); te.textContent = p.text; te.style.fontWeight = 'bold';
  const tr = document.createElement('div'); tr.className = 'translation'; tr.textContent = p.translation; tr.style.display = 'none';
  card.appendChild(te); card.appendChild(tr);
  card.dataset.row = p.row;
  card.dataset.col = p.col;
  card.dataset.translation = p.translation;
  card.setAttribute('draggable', 'true');

  card.addEventListener('click', () => placeCard(card));
  card.addEventListener('dragstart', dragStart);
  return card;
}

function dragStart(e) {
  e.dataTransfer.setData('text/plain', e.target.outerHTML);
  e.dataTransfer.setData('card-row', e.target.dataset.row);
  e.dataTransfer.setData('card-col', e.target.dataset.col);
  e.target.classList.add('dragging');
}

function allowDrop(e) {e.preventDefault();}

function dropCard(e) {
  e.preventDefault();
  const cell = e.currentTarget;
  if (cell.classList.contains('invalid')) return;

  const dragging = document.querySelector('.dragging');
  if (!dragging) return;

  const existingCard = cell.querySelector('.card:not(.fixed-card)');
  if (existingCard) {
    addToPool(existingCard);
    existingCard.remove();
  }

  cell.appendChild(dragging);
  dragging.classList.remove('dragging');

  checkPlacement(cell, dragging);
  removeFromPool(dragging);
  nextEmptyCell();
  checkGameCompletion();
}

function addToPool(card) {
  const pronounText = card.querySelector('div:not(.translation)').textContent;
  const pronoun = pronouns.find(p => p.text === pronounText);
  if (pronoun && !currentPool.some(p => p.text === pronounText)) {
    currentPool.push(pronoun);
  }
}

function removeFromPool(card) {
  const pronounText = card.querySelector('div:not(.translation)').textContent;
  const index = currentPool.findIndex(p => p.text === pronounText);
  if (index > -1) {
    currentPool.splice(index, 1);
  }
  renderPool();
}

function nextEmptyCell() {
  if (selectedCell) selectedCell.classList.remove('selected');
  selectedCell = null;
  const cells = document.querySelectorAll('.grid-cell:not(.invalid)');
  for (const c of cells) {
    if (!c.querySelector('.card:not(.fixed-card)')) {
      c.classList.add('selected');
      selectedCell = c;
      return;
    }
  }
}

function placeCard(card) {
  if (!selectedCell) return;
  if (selectedCell.classList.contains('invalid')) return;

  const existingCard = selectedCell.querySelector('.card:not(.fixed-card)');
  if (existingCard) {
    addToPool(existingCard);
    existingCard.remove();
  }

  selectedCell.appendChild(card);
  checkPlacement(selectedCell, card);
  removeFromPool(card);
  nextEmptyCell();
  checkGameCompletion();
}

function checkPlacement(cell, card) {
  card.classList.remove('correct');
  card.style.background = 'pink';
  if (card.dataset.row === cell.dataset.row && card.dataset.col === cell.dataset.col) {
    card.style.background = rowColors[cell.dataset.row];
    card.classList.add('correct');
  }
}

function checkGameCompletion() {
  const cells = document.querySelectorAll('.grid-cell:not(.invalid)');
  const allCorrect = Array.from(cells).every(c => {
    const card = c.querySelector('.card');
    return card && card.classList.contains('correct');
  });
  if (allCorrect) {
    showCompletionMessage();
  }
}

function showCompletionMessage() {
  const message = 'tika - tino pai';
  const completionDiv = document.getElementById('completionMessage');
  completionDiv.innerHTML = '';
  message.split('').forEach((letter, index) => {
    if (letter === ' ') return completionDiv.appendChild(document.createTextNode(' '));
    const span = document.createElement('span');
    span.className = 'rainbow-letter';
    span.textContent = letter;
    span.style.color = rainbowColors[index % rainbowColors.length];
    completionDiv.appendChild(span);
  });
  completionDiv.style.display = 'block';
}

document.querySelectorAll('.grid-cell').forEach(cell => {
  cell.addEventListener('dragover', allowDrop);
  cell.addEventListener('drop', dropCard);
  cell.addEventListener('click', () => {
    if (cell.classList.contains('invalid')) return;
    if (selectedCell) selectedCell.classList.remove('selected');
    selectedCell = cell;
    cell.classList.add('selected');
  });
});

document.getElementById('newGameBtn').addEventListener('click', newGame);

document.getElementById('showSolutionBtn').addEventListener('click', () => {
  document.querySelectorAll('.grid-cell:not(.invalid)').forEach(c => {
    const pron = pronouns.find(p => p.row === c.dataset.row && p.col === c.dataset.col);
    if (pron) {
      const existingCard = c.querySelector('.card:not(.fixed-card)');
      if (existingCard) {
        existingCard.remove();
      }
      const card = createCard(pron);
      c.appendChild(card);
      checkPlacement(c, card);
    }
  });
  currentPool = [];
  renderPool();
  checkGameCompletion();
});

document.getElementById('showTranslationBtn').addEventListener('click', () => {
  const translations = document.querySelectorAll('.translation');
  const shouldShow = translations[0] ? translations[0].style.display === 'none' : true;
  translations.forEach(t => t.style.display = shouldShow ? 'block' : 'none');
});

newGame();
</script>
</body>
</html>