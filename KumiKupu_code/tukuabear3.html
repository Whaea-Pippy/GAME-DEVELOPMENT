<!doctype html>
<html lang="mi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Millionaire: Kei hea te pea? Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Deep Indigo, Teal & Gold Theme */
      --bg-grad: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
      --card-bg: #ffffff;
      --text: #1e293b;
      --accent: #f59e0b; /* Gold */
      --primary: #4f46e5; /* Indigo */
      --muted: #64748b;
      --good: #10b981; /* Emerald */
      --bad: #ef4444; /* Red */
      
      font-family: 'Poppins', system-ui, sans-serif;
    }
    
    html,body{height:100%;margin:0;background:var(--bg-grad);color:var(--text);font-family:'Poppins', sans-serif;}
    
    .wrap{
      min-height:90vh;
      width:95%;
      max-width:1100px;
      margin:2vh auto;
      display:grid;
      grid-template-columns:1fr 320px;
      gap:20px;
      align-items:start;
    }
    @media (max-width:900px){.wrap{grid-template-columns:1fr;padding-bottom:5vh}}

    /* Header */
    header{
      grid-column:1/-1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding:15px 20px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.2);
      color:white;
    }
    h1{font-family:'Fredoka', sans-serif; font-size:1.8rem; margin:0; color:#fbbf24; text-shadow:0 2px 4px rgba(0,0,0,0.3);}
    .meta{font-size:0.95rem; opacity:0.9;}

    /* Cards */
    .card{
      background:var(--card-bg);
      border-radius:20px;
      padding:24px;
      box-shadow:0 10px 25px rgba(0,0,0,0.2);
      border: 4px solid #fff;
    }

    /* Game Area */
    .game{min-height:50vh; display:flex; flex-direction:column; justify-content:center;}
    
    #status { 
      background: #e0e7ff; color: #3730a3; padding: 5px 12px; 
      border-radius: 20px; display: inline-block; font-weight: 600; font-size: 0.9rem;
    }

    .question{
      font-size:1.8rem;
      font-weight: 600;
      margin: 20px 0 30px;
      color: #1e1b4b;
      line-height: 1.3;
    }
    .question small{display:block;color:var(--muted);font-size:1.1rem;margin-top:10px; font-weight:400; font-style:italic;}

    .answers{display:grid;grid-template-columns:1fr 1fr;gap:15px}
    @media (max-width:600px){.answers{grid-template-columns:1fr}}

    .btn{
      background: white;
      border: 2px solid #e2e8f0;
      color: #334155;
      padding: 16px 20px;
      border-radius: 12px;
      cursor:pointer;
      text-align:left;
      font-size:1.2rem;
      transition: all 0.2s;
      position: relative;
      font-weight: 500;
    }
    .btn:hover{background:#f8fafc; border-color:#94a3b8; transform:translateY(-2px);}
    .btn.correct{border-color:var(--good);background:#d1fae5; color:#065f46; font-weight:700;}
    .btn.wrong{border-color:var(--bad);background:#fee2e2; color:#991b1b;}
    
    .btn:disabled { cursor: default; transform: none; }

    #resetBtn { 
      background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); 
      color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight:600; transition:0.2s;
    }
    #resetBtn:hover { background: rgba(255,255,255,0.3); }

    /* Sidebar / Ladder */
    .sidebar{position:sticky;top:20px;height:fit-content; background: #1e1b4b; color: white; border: 4px solid #312e81;}
    
    .ladder{list-style:none;padding:0;margin:0;}
    .ladder li{
      padding:8px 12px;
      border-radius:8px;
      margin-bottom:4px;
      display:flex;justify-content:space-between;align-items:center;
      color: rgba(255,255,255,0.6);
      font-size: 0.95rem;
    }
    .ladder li strong { color: rgba(255,255,255,0.8); }
    .ladder li.active{
      background:var(--accent);
      color:#1e1b4b;
      font-weight:bold;
      transform: scale(1.02);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .ladder li.active strong { color: #1e1b4b; }

    /* Footer & Lifelines */
    .footer{margin-top:auto; padding-top:20px;}
    .lifelines{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
    .life{
      padding:8px 16px; border-radius:20px; background:#e0e7ff; 
      color: #3730a3; cursor:pointer; border:2px solid #c7d2fe; font-weight:600; font-size:0.9rem;
      transition: 0.2s;
    }
    .life:hover { background: #c7d2fe; }
    .life.used{opacity:0.5;text-decoration:line-through;cursor:default; filter:grayscale(1);}
    .lifelines.hidden { display: none; }

    #nextBtn { 
      background: var(--primary); color: white; border:none; 
      padding: 12px 24px; font-weight: bold; float: right; display: none; 
      box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
      border-radius: 8px; cursor: pointer; font-size: 1rem;
    }
    #nextBtn:hover { background: #4338ca; }

    /* Confetti */
    #confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none; z-index: 100;}

    .teacher-joke{
      font-style:italic; color:#64748b; margin-top:10px; font-size:1rem; 
      background: #f1f5f9; padding: 10px; border-radius: 8px; border-left: 4px solid var(--accent);
    }
    
    /* Winning Styles */
    .big-win{font-size:2rem;color:var(--good);font-weight:700; text-align: center; margin-bottom: 20px;}
    .restart-big {
      background: var(--primary); color: white; border: none; padding: 15px 30px; 
      font-size: 1.2rem; border-radius: 12px; cursor: pointer; font-weight: bold;
      margin-top: 20px; box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
    }
    .restart-big:hover { transform: scale(1.05); transition: 0.2s; }

    /* Responsive */
    @media (max-width:420px){
      h1{font-size:1.4rem}
      .question{font-size:1.4rem}
      .btn{font-size:1rem;padding:14px}
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <header>
      <div>
        <h1>Kei hea te pea? üß∏üí∞</h1>
        <div class="meta">Millionaire Challenge: Locatives Edition</div>
      </div>
      <button id="resetBtn">Restart</button>
    </header>

    <main class="card game">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div id="status">PƒÅtai <span id="qIndex">1</span> / <span id="qTotal">10</span></div>
        <div id="points" style="font-weight:bold; color:var(--primary); font-size:1.2rem;">$0</div>
      </div>

      <div id="questionBox">
        <div class="question" id="questionText">Loading...</div>
        <div class="answers" id="answers"></div>
      </div>

      <div class="footer">
        <div class="lifelines" id="lifelines">
          <div class="life" data-life="50">50:50</div>
          <div class="life" data-life="ask">Ask the Class</div>
          <div class="life" data-life="skip">Skip Question</div>
        </div>
        
        <div class="teacher-joke" id="joke">
          Kaiako Tip: Take your time. Don't let the bear scare you! üß∏
        </div>
        
        <div style="margin-top:15px; overflow:hidden;">
          <button id="nextBtn">Next Question ‚ûú</button>
        </div>
      </div>
    </main>

    <aside class="card sidebar">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px;">
        <div>
          <div style="font-size:0.8rem; opacity:0.7;">TOTAL SAVED</div>
          <div id="userPoints" style="font-size:1.5rem; font-weight:bold; color:#fbbf24;">$0</div>
        </div>
      </div>

      <div style="margin-bottom:20px">
        <ul class="ladder" id="ladder"></ul>
      </div>

      <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:8px;">
        <strong style="color:#fbbf24;">He Whakataukƒ´</strong>
        <p style="font-size:0.85rem; margin:5px 0 0; opacity:0.8;">"Ahakoa he iti, he pounamu." (Although it is small, it is greenstone.)</p>
      </div>
    </aside>
  </div>

  <script>
    const QUESTIONS = [
      { q: 'What does the word "Roto" mean?', choices:['Outside','Inside','Under','Above'], answer:1, hint:'Opposite of waho.' },
      { q: 'Complete the phrase: "Kei ____ te pea." (The bear is *under*).', choices:['runga','waho','raro','muri'], answer:2, hint:'Down low.' },
      { q: 'Which particle do we use for "Waho"? (Kei waho ___ te whare).', choices:['i','ki','o','a'], answer:2, hint:'Waho and Mua are special!' },
      { q: 'Translate: "Kei hea te pea?"', choices:['Who is the bear?','Where is the bear?','Is that a bear?','How is the bear?'], answer:1, hint:'Hea = Where.' },
      { q: 'What does "Muri" mean?', choices:['Behind','In front','Beside','Between'], answer:0, hint:'If you are late, you are left...' },
      { q: 'The bear is *beside* the table. "Kei te ____ i te tƒìpu."', choices:['waenganui','taha','runga','raro'], answer:1, hint:'Side / Edge.' },
      { q: 'Which sentence is "Switched" order?', choices:['Kei roto i te whare te pea.','Kei roto te pea i te whare.','Kei te pea i te whare.','I te whare te pea.'], answer:1, hint:'Subject (pea) comes early.' },
      { q: 'What is the particle for "Waenganui" (Between)? Kei waenganui i te tƒìpu ____ te t≈´ru.', choices:['o','a','me','ki'], answer:2, hint:'The table AND the chair.' },
      { q: 'Translate: "Kei mua o te whare."', choices:['In front of the house','Behind the house','Inside the house','On top of the house'], answer:0, hint:'The front door is at the Mua.' },
      { q: 'If "Kei" is NOW, which word is PAST tense?', choices:['Ka','Kua','I','E'], answer:2, hint:'I roto i te whare...' }
    ];

    const PRIZES = [100, 200, 300, 500, 1000, 2000, 4000, 8000, 16000, 1000000];

    let idx = 0;
    let winnings = 0;
    let usedLifelines = { '50': false, ask: false, skip: false };

    const qTotal = QUESTIONS.length;
    document.getElementById('qTotal').innerText = qTotal;

    const ladderEl = document.getElementById('ladder');
    PRIZES.slice().reverse().forEach((p, i) => {
      const li = document.createElement('li');
      li.id = 'lad-' + (PRIZES.length - 1 - i);
      li.innerHTML = `<span>${PRIZES.length - i}</span> <strong>$${p.toLocaleString()}</strong>`;
      ladderEl.appendChild(li);
    });

    function saveSession() {
      localStorage.setItem('loc_winnings', winnings);
      document.getElementById('userPoints').innerText = `$${winnings.toLocaleString()}`;
    }

    function loadSession() {
      const p = localStorage.getItem('loc_winnings') || 0;
      winnings = Number(p);
      document.getElementById('points').innerText = `$${winnings.toLocaleString()}`;
      document.getElementById('userPoints').innerText = `$${winnings.toLocaleString()}`;
    }

    function renderQuestion() {
      if (idx >= QUESTIONS.length) return;
      document.getElementById('nextBtn').style.display = 'none';
      const Q = QUESTIONS[idx];
      document.getElementById('qIndex').innerText = idx + 1;
      document.getElementById('questionText').innerHTML = Q.q + (Q.hint ? (`<small>Hint: ${Q.hint}</small>`) : '');

      const answers = document.getElementById('answers');
      answers.innerHTML = '';
      Q.choices.forEach((c, i) => {
        const b = document.createElement('button');
        b.className = 'btn';
        b.innerHTML = `<span style="color:var(--accent); font-weight:bold; margin-right:10px;">${['A','B','C','D'][i]}:</span> ${c}`;
        b.dataset.index = i;
        b.addEventListener('click', onAnswer);
        answers.appendChild(b);
      });

      document.querySelectorAll('.ladder li').forEach(li => li.classList.remove('active'));
      const curL = document.getElementById('lad-' + idx);
      if (curL) curL.classList.add('active');
    }

    function onAnswer(e) {
      const chosen = Number(e.currentTarget.dataset.index);
      const Q = QUESTIONS[idx];
      const buttons = Array.from(document.querySelectorAll('.answers .btn'));
      buttons.forEach(btn => btn.disabled = true); 

      if (chosen === Q.answer) {
        e.currentTarget.classList.add('correct');
        winnings = PRIZES[idx];
        document.getElementById('points').innerText = `$${winnings.toLocaleString()}`;
        document.getElementById('joke').innerText = pickTeacherPraise();
        
        const nextBtn = document.getElementById('nextBtn');
        nextBtn.style.display = 'block';
        nextBtn.onclick = nextQuestion; // ENSURE BUTTON FUNCTIONS AS NEXT
        
        if (idx === QUESTIONS.length - 1) {
          nextBtn.innerHTML = "Claim $1,000,000! üèÜ";
        } else {
          nextBtn.innerHTML = "Next Question ‚ûú";
        }
        
        saveSession();
        celebrate();
      } else {
        e.currentTarget.classList.add('wrong');
        const correctBtn = buttons.find(b => Number(b.dataset.index) === Q.answer);
        if (correctBtn) correctBtn.classList.add('correct');
        document.getElementById('joke').innerText = "Auƒì! Not quite. The correct answer is highlighted.";
        winnings = 0; 
        handleWrongAnswer();
      }
    }

    function handleWrongAnswer() {
      gameOver(false);
      triggerBlackConfetti();
    }

    function nextQuestion() {
      idx++;
      if (idx >= QUESTIONS.length) {
        gameOver(true);
        return;
      }
      document.getElementById('joke').innerText = "Kaiako Tip: Take your time. Don't let the bear scare you! üß∏";
      renderQuestion();
    }
    
    function resetGame() {
      idx = 0;
      winnings = 0;
      usedLifelines = { '50': false, ask: false, skip: false };
      
      // RESTORE DOM
      document.getElementById('questionBox').innerHTML = `
        <div class="question" id="questionText">Loading...</div>
        <div class="answers" id="answers"></div>
      `;
      
      // RESTORE BUTTON FUNCTIONALITY
      document.getElementById('nextBtn').onclick = nextQuestion; 
      
      document.getElementById('points').innerText = `$0`;
      document.querySelectorAll('.life').forEach(l => l.classList.remove('used'));
      document.getElementById('lifelines').classList.remove('hidden');
      document.getElementById('joke').innerText = 'New Game! Kei hea te pea?';
      renderQuestion();
    }

    // Initial listener setup
    document.getElementById('nextBtn').onclick = nextQuestion;
    document.getElementById('resetBtn').addEventListener('click', resetGame);

    document.getElementById('lifelines').addEventListener('click', (ev) => {
      const t = ev.target.closest('.life');
      if (!t || t.classList.contains('used')) return;
      useLifeline(t.dataset.life, t);
    });

    function useLifeline(name, el) {
      usedLifelines[name] = true;
      el.classList.add('used');
      const Q = QUESTIONS[idx];

      if (name === '50') {
        const wrongs = [];
        Q.choices.forEach((c, i) => { if (i !== Q.answer) wrongs.push(i); });
        wrongs.sort(() => Math.random() - 0.5);
        const toRemove = wrongs.slice(0, 2);
        document.querySelectorAll('.answers .btn').forEach(b => {
          if (toRemove.includes(Number(b.dataset.index))) {
            b.style.opacity = '0.2';
            b.disabled = true;
          }
        });
        showToast('50:50 Used! Two wrong answers removed.');

      } else if (name === 'ask') {
        const labels = ['A','B','C','D'];
        let correctPercent = 60 + Math.floor(Math.random() * 20);
        showToast(`The Class says: ${labels[Q.answer]} is ${correctPercent}% likely!`);
      } else if (name === 'skip') {
        showToast('Skipped! You keep your points.');
        setTimeout(nextQuestion, 1000);
      }
    }

    function gameOver(won) {
      document.getElementById('lifelines').classList.add('hidden');
      document.getElementById('nextBtn').style.display = 'none'; 

      if (won) {
        document.getElementById('questionBox').innerHTML = `
          <div style="text-align:center; padding: 20px;">
            <div class="big-win">KUA TOA KOE! <br> YOU WON $1,000,000! üß∏üéâ</div>
            <p style="font-size:1.2rem; color:#444;">The bear is very proud of you.</p>
            <button class="restart-big" onclick="resetGame()">Tƒ´mata An≈ç (Play Again)</button>
          </div>
        `;
        triggerConfetti();
      } else {
         setTimeout(() => {
           const nextBtn = document.getElementById('nextBtn');
           nextBtn.style.display = 'block';
           nextBtn.innerHTML = "Try Again ‚Üª";
           nextBtn.onclick = resetGame; // Switch button to reset mode
        }, 1500);
      }
      saveSession();
    }

    function showToast(msg) { document.getElementById('joke').innerText = msg; }

    function pickTeacherPraise() {
      const list = ['Ka rawe! The bear is happy! üß∏', 'Tino pai! You know your locations! üìç', 'Kei runga noa atu! (Top notch!) üåü'];
      return list[Math.floor(Math.random() * list.length)];
    }

    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    
    function resizeCanvas() { confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function triggerConfetti() {
      confettiPieces = [];
      for (let i = 0; i < 150; i++) {
        confettiPieces.push({ 
          x: Math.random() * confettiCanvas.width, 
          y: Math.random() * -confettiCanvas.height, 
          r: Math.random() * 6 + 4, 
          d: Math.random() * 4 + 2, 
          tilt: Math.random() * 10, 
          color: `hsl(${Math.random() * 50 + 40}, 100%, 50%)`
        });
      }
      requestAnimationFrame(drawConfetti);
    }

    function triggerBlackConfetti() {
      confettiPieces = [];
      for (let i = 0; i < 50; i++) {
        confettiPieces.push({ 
          x: Math.random() * confettiCanvas.width, 
          y: Math.random() * -confettiCanvas.height, 
          r: Math.random() * 5 + 3,
          d: Math.random() * 3 + 1, 
          tilt: Math.random() * 10, 
          color: `rgba(0,0,0,0.2)`
        });
      }
      requestAnimationFrame(drawConfetti);
    }

    function drawConfetti() {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      let active = false;
      confettiPieces.forEach(p => {
        p.y += p.d; p.tilt += 0.1;
        if (p.y < confettiCanvas.height) active = true;
        
        ctx.save(); 
        ctx.translate(p.x, p.y); 
        ctx.rotate(p.tilt * 0.1);
        ctx.fillStyle = p.color; 
        ctx.fillRect(-p.r / 2, -p.r / 2, p.r, p.r * 0.6);
        ctx.restore();
      });
      if (active) requestAnimationFrame(drawConfetti);
    }

    function celebrate() { triggerConfetti(); }

    loadSession();
    renderQuestion();

  </script>
</body>
</html>